<#
.SYNOPSIS
    Enables or disables mitigation for CVE-2013-3900 by configuring the 
    'EnableCertPaddingCheck' registry key, which enforces stricter Authenticode 
    signature validation in Windows. This script supports both native 64-bit 
    and WOW6432Node registry paths to ensure comprehensive coverage.

    WARNING: This change can affect the loading of unsigned or improperly signed 
    executables. Always test in a non-production environment before deploying.

    Must be run with Administrator privileges.
    Please test thoroughly in a non-production environment before deploying widely.
    Make sure to run as Administrator or with appropriate privileges.

.NOTES
    Author        : Suhail Al-Tashi
    Date Created  : 2025-15-06
    Last Modified : 2025-15-06
    Version       : 1.0

.TESTED ON
    Date(s) Tested  : 2025-15-06
    Tested By       : Suhail Al-Tashi
    Systems Tested  : Windows Server 2019 Datacenter, Build 1809
    PowerShell Ver. : 5.1.17763.6189

# Toggle the fix (Set to $true to enable, $false to disable)
$enableFix = $true
#>
# Registry paths for 64-bit Windows
$regPath64 = "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config"
$regPathWow6432 = "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config"

# Value name
$valueName = "EnableCertPaddingCheck"

# Function to enable the fix
function Enable-Fix {
    Write-Host "Enabling stricter Authenticode verification..."
    # Set the registry keys for both 64-bit and 32-bit locations
    Set-ItemProperty -Path $regPath64 -Name $valueName -Value "1" -Type String -Force
    Set-ItemProperty -Path $regPathWow6432 -Name $valueName -Value "1" -Type String -Force
    Write-Host "Fix enabled. Please restart the computer for the changes to take effect."
}

# Function to disable the fix
function Disable-Fix {
    Write-Host "Disabling stricter Authenticode verification..."
    # Remove the registry keys for both 64-bit and 32-bit locations
    Remove-ItemProperty -Path $regPath64 -Name $valueName -ErrorAction SilentlyContinue
    Remove-ItemProperty -Path $regPathWow6432 -Name $valueName -ErrorAction SilentlyContinue
    Write-Host "Fix disabled. Please restart the computer for the changes to take effect."
}

# Check the toggle and apply the corresponding action
if ($enableFix) {
    Enable-Fix
} else {
    Disable-Fix
}
